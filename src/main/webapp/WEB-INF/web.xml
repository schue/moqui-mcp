<?xml version="1.0" encoding="UTF-8"?>
<!--
  This software is in the public domain under CC0 1.0 Universal plus a 
  Grant of Patent License.
  
  To the extent possible under law, author(s) have dedicated all
  copyright and related and neighboring rights to this software to the
  public domain worldwide. This software is distributed without any
  warranty.
  
  You should have received a copy of the CC0 Public Domain Dedication
  along with this software (see the LICENSE.md file). If not, see
  <http://creativecommons.org/publicdomain/zero/1.0/>.
-->

<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee 
                             http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <!-- Service-Based MCP Servlet Configuration -->
    <servlet>
        <servlet-name>EnhancedMcpServlet</servlet-name>
        <servlet-class>org.moqui.mcp.EnhancedMcpServlet</servlet-class>
        
        <init-param>
            <param-name>keepAliveIntervalSeconds</param-name>
            <param-value>30</param-value>
        </init-param>
        <init-param>
            <param-name>maxConnections</param-name>
            <param-value>100</param-value>
        </init-param>
        
        <!-- Enable async support for SSE -->
        <async-supported>true</async-supported>
        
        <!-- Load on startup -->
        <load-on-startup>5</load-on-startup>
    </servlet>
    
    <servlet-mapping>
        <servlet-name>EnhancedMcpServlet</servlet-name>
        <url-pattern>/mcp/*</url-pattern>
    </servlet-mapping>
    
    <!-- Session Configuration -->
    <session-config>
        <session-timeout>30</session-timeout>
        <cookie-config>
            <http-only>true</http-only>
            <secure>false</secure>
        </cookie-config>
    </session-config>
    
    <!-- Security Constraints (optional - uncomment if needed) -->
    <!--
    <security-constraint>
        <web-resource-collection>
            <web-resource-name>MCP Endpoints</web-resource-name>
            <url-pattern>/sse/*</url-pattern>
            <url-pattern>/mcp/message/*</url-pattern>
            <url-pattern>/rpc/*</url-pattern>
        </web-resource-collection>
        <auth-constraint>
            <role-name>admin</role-name>
        </auth-constraint>
    </security-constraint>
    
    <login-config>
        <auth-method>BASIC</auth-method>
        <realm-name>Moqui MCP</realm-name>
    </login-config>
    -->
    
    <!-- MIME Type Mappings -->
    <mime-mapping>
        <extension>json</extension>
        <mime-type>application/json</mime-type>
    </mime-mapping>
    
    <!-- Default Welcome Files -->
    <welcome-file-list>
        <welcome-file>index.html</welcome-file>
        <welcome-file>index.jsp</welcome-file>
    </welcome-file-list>

</web-app>
